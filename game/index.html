<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clue for You</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f7f7f7;
      color: #333;
      padding: 2rem;
      max-width: 500px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .box {
      background: #fff;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-top: 2rem;
    }
    input, button {
      width: 100%;
      padding: 0.6rem;
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    .link-box {
      word-break: break-all;
      margin-top: 1rem;
      background: #eaf7ea;
      padding: 0.8rem;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>üîê Clue for You</h1>

  <div class="box" id="game">

    <!-- Game mode appears here -->
  </div>

  <script>
  const gameDiv = document.getElementById('game');
  const urlParams = new URLSearchParams(window.location.search);
  const clue = urlParams.get('clue');
  const code = urlParams.get('code');

  // Helper functions
  function encodeBase64(str) {
    return btoa(unescape(encodeURIComponent(str)));
  }

  function decodeBase64(str) {
    try {
      return decodeURIComponent(escape(atob(str)));
    } catch (e) {
      return null;
    }
  }

  // --- Mode 1: Player 1 gives clue ---
  if (!clue && !code) {
    const wordList = ['elephant', 'guitar', 'banana', 'moon', 'book', 'ocean', 'castle', 'snow', 'fire', 'puzzle'];
    const secretWord = wordList[Math.floor(Math.random() * wordList.length)];

    gameDiv.innerHTML = `
      <p>Your word is: <strong>${secretWord}</strong></p>
      <label for="clueInput">Enter a clue to send:</label>
      <input type="text" id="clueInput" placeholder="e.g. memory">
      <button onclick="generateLink('${secretWord}')">Generate Shareable Link</button>
      <div id="shareLink" class="link-box" style="display:none;"></div>
    `;

    window.generateLink = function(word) {
      const clueText = document.getElementById('clueInput').value.trim();
      if (clueText === '') {
        alert('Please enter a clue!');
        return;
      }
      const encodedClue = encodeURIComponent(clueText);
      const encodedAnswer = encodeBase64(word);
      const link = `${window.location.origin}${window.location.pathname}?clue=${encodedClue}&code=${encodedAnswer}`;
      document.getElementById('shareLink').innerHTML = `<strong>Send this link to your partner:</strong><br><a href="${link}">${link}</a>`;
      document.getElementById('shareLink').style.display = 'block';
    };
  }

  // --- Mode 2: Player 2 guesses ---
  else if (clue && code) {
    const decodedAnswer = decodeBase64(code)?.toLowerCase();

    if (!decodedAnswer) {
      gameDiv.innerHTML = '<p>‚ö†Ô∏è Invalid game link or corrupted code.</p>';
    } else {
      gameDiv.innerHTML = `
        <p>Your clue is: <strong>${clue}</strong></p>
        <label for="guessInput">What do you think the word is?</label>
        <input type="text" id="guessInput" placeholder="Type your guess">
        <button onclick="checkGuess('${decodedAnswer}')">Submit Guess</button>
        <div id="result"></div>
      `;

      window.checkGuess = function(correctAnswer) {
        const guess = document.getElementById('guessInput').value.trim().toLowerCase();
        const resultDiv = document.getElementById('result');
        if (guess === '') {
          resultDiv.textContent = 'Please enter a guess.';
        } else if (guess === correctAnswer) {
          resultDiv.innerHTML = '‚úÖ Correct! You guessed it!';
        } else {
          resultDiv.innerHTML = '‚ùå Nope! Try again or ask for a better clue.';
        }
      };
    }
  }

  // Invalid or malformed link
  else {
    gameDiv.innerHTML = '<p>Invalid game link.</p>';
  }
</script>
</body>
</html>
